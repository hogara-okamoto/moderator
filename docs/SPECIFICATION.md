## 📝 生成AI議論ファシリテーションシステム 仕様書

### 1. プロジェクト概要

* **システム名称:** 匿名議論ファシリテーションエージェントシステム
* **目的:** 複数の人間ユーザーが匿名で参加するオンライン議論において、生成AIエージェント群が司会者・分析者として機能し、議論を構造的に管理し、客観的なデータに基づいて結論へと導くこと。
* **開発環境:** Google ADK（Agent Development Kit）とNext.jsを使用したウェブアプリケーション。
* **多言語対応:** 本システムは英語と日本語の2言語に対応しており、ユーザーはどちらの言語でも議論に参加可能です。
* **エージェント基盤:** 本システムはGoogle ADK（Agent Development Kit）を使用することを想定しており、エージェント群はADKの機能を活用して実装されます。

---

### 2. システム構成とアーキテクチャ

| カテゴリ | コンポーネント | 技術スタック（想定） |
| :--- | :--- | :--- |
| **フロントエンド** | 議論インターフェース | **Next.js** (単一の共有`page.tsx`、認証機能なし) |
| **バックエンド** | APIゲートウェイ、リアルタイム層 | Node.js (Express/Fastify) または Python (FastAPI/Django) + WebSocket/Socket.IO |
| **エージェント群** | ルートエージェント、サブエージェント | **Google ADK** (Gemini 2.5ベース) |
| **データ永続化** | 会話履歴、議論の状態 | PostgreSQL, Firestore, または Redis (セッション/リアルタイムデータ) |

---

### 3. エージェント群の役割定義（ADKエージェント）

本システムの核となるエージェント群は以下の通りです。

| エージェントの役割 | ADKタイプ | 主な機能と判断基準 |
| :--- | :--- | :--- |
| **ルートエージェント** (ModeratorAgent) **司会者** | `LlmAgent` + `Workflow Agent` | 議論の開始、論点の提示、質問のルーティング、**結論の形成**。意見の論理的な流れとルール遵守を判断基準とする。 |
| **データ収集エージェント** (DataGatheringAgent) | `LlmAgent` | 議論中に提起された主張を裏付けるための**客観的な最新情報**を検索・提示する。 |
| **意見要約エージェント** (OpinionSummarizer) | `LlmAgent` | 全参加者の発言から、**主要な論点、賛否、未解決のギャップ**を抽出し、論理的な重み付けに基づいて要約する。 |
| **感情分析エージェント** (SentimentAnalyzer) | `LlmAgent` / 外部Tool | 発言の**トーンと感情（ネガティブ、攻撃性など）**を分析し、ルートエージェントに介入を促すアラートを生成する。 |

---

### 4. 機能要件

#### 4.1. フロントエンド要件 (Next.js)

* **単一共有ページ:** ユーザー認証を必要とせず、誰でもアクセス可能な単一の議論ページ。
* **リアルタイム表示:** 他の参加者の発言、エージェントの応答、議論の状態変化を**リアルタイム**で全ユーザーに表示すること。
* **入力インターフェース:** シンプルなテキスト入力フィールドと送信ボタン。
* **匿名ID表示:** 発言時に「参加者 #1」「User B」などの**一時的な匿名ID**をシステムが付与し、発言と紐づけて表示する。
* **多言語対応:** 英語と日本語の2言語に対応し、ユーザーは希望する言語で発言可能。エージェントは入力された言語を自動検出し、同じ言語で応答する。

#### 4.2. バックエンド・セッション管理要件

* **議論IDの管理:** 複数ユーザーがアクセスした際に、**単一の共有議論インスタンス（議論ID）**を確立し、セッションを共有すること。
* **リアルタイム通信:** WebSocketなどを利用し、全参加者への発言・応答のブロードキャストを担うこと。
* **投稿頻度制限:** **IPアドレス**または**セッションID**に基づき、短時間での連続投稿を制限する機能を実装し、荒らし行為を防止すること（匿名環境の健全性維持）。

#### 4.3. エージェント機能要件

* **議論の状態管理:** ルートエージェントが議論IDに基づき、会話履歴、現在の論点、合意事項、未解決のギャップなどの**議論の状態**を永続化すること。
* **公平な進行:** 発言の投稿元（匿名ID）に関わらず、発言の**内容の質**と**論理性**に基づいて議論を進行させること。
* **結論形成プロセス:** 議論の収束フェーズで、エージェント群が合意された論点と未解決の課題を統合し、**結論のドラフト**を作成・提示する機能。
* **多言語処理:** エージェントは英語と日本語の両方の言語を理解し、適切に処理する。異なる言語で発言された場合でも、内容を正確に理解し、必要に応じて翻訳や要約を行う。
* **Google ADK統合:** エージェント群はGoogle ADKの機能（LlmAgent、Workflow Agent、Tool統合など）を活用して実装され、ADKのエコシステムに完全に統合される。

---

### 5. 非機能要件

* **拡張性:** 将来的に参加者数が増加した場合でも、リアルタイム通信とエージェント処理が負荷に耐えられるアーキテクチャであること。
* **パフォーマンス:** ユーザーの入力からエージェントの応答が画面に表示されるまでの遅延を最小限に抑えること（理想は3秒以内）。
* **セキュリティ:** 個人認証はしないが、API通信はHTTPSを必須とし、投稿頻度制限や悪意のある入力への防御策を講じること。


/my_project_root (プロジェクトのルート)
├── /frontend/           <-- 1. Next.js (フロントエンド) http://localhost:3000
│   ├── /app/
│   │   └── page.tsx     (前回作成したUIページ)
│   ├── /public/
│   ├── package.json     (Next.jsの依存関係)
│   ├── next.config.js
│   └── ... (他のNext.js関連ファイル)
│
├── /backend/            <-- 2. Python (バックエンド / API) http://localhost:8000
│   ├── agents/
│   ├── __init__.py              # エージェントのエクスポート
│   ├── moderator_agent.py      # ルートエージェント（司会者）
│   ├── data_gathering_agent.py  # データ収集エージェント
│   ├── sentiment_analyzer_agent.py # 感情分析エージェント
│   └── opinion_summarizer_agent.py # 意見要約エージェント
├── tools/
│   ├── data_gathering.py        # データ収集ツール
│   └── sentiment_analysis.py   # 感情分析ツール
├── utils/
│   ├── messages.py              # メッセージ変換ユーティリティ
│   └── context.py              # コンテキスト変数
├── adk_agents.py                # 後方互換性のための再エクスポート
└── main.py                      # 変更不要（後方互換性により動作）
│
└── .gitignore           (ルートに置く)


pip install fastapi uvicorn "google-generativeai>=0.7.0" "google-cloud-aiplatform>=1.52.0"
pip install google-adk

